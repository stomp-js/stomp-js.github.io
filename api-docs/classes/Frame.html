<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>stompjs-docs documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/Vagrant.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">stompjs-docs documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">











<ol class="breadcrumb">
  <li>Classes</li>
  <li>Frame</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>consolidated/stompjs/src/frame.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Frame class represents a STOMP frame. Many of the callbacks pass the Frame received from
the STOMP broker. For advanced usage you might need to access <a href="../classes/Frame.html#headers">headers</a>.</p>
<p><a href="../interfaces/Message.html">Message</a> is an extended Frame.</p>

            </p>




            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#command">command</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#headers">headers</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#isBinaryBody">isBinaryBody</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#serialize">serialize</a>
                            </li>
                        </ul>
                    </td>
                </tr>





                    <tr>
                        <td class="col-md-4">
                            <h6><b>Accessors</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                    <a href="#body">body</a>
                                </li>
                                <li>
                                    <a href="#binaryBody">binaryBody</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
        </tbody>
    </table>
</section>


            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="command"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            command
                            </b>
                            <a href="#command"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>command:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="20" class="link-to-prism">consolidated/stompjs/src/frame.ts:20</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>STOMP Command</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="headers"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            headers
                            </b>
                            <a href="#headers"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>headers:     <code><a href="../interfaces/StompHeaders.html" target="_self" >StompHeaders</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="../interfaces/StompHeaders.html" target="_self" >StompHeaders</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="25" class="link-to-prism">consolidated/stompjs/src/frame.ts:25</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>Headers, key value pairs.</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="isBinaryBody"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            isBinaryBody
                            </b>
                            <a href="#isBinaryBody"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>isBinaryBody:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="27" class="link-to-prism">consolidated/stompjs/src/frame.ts:27</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="methods">
            Methods
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="serialize"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            serialize
                            </b>
                            <a href="#serialize"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>serialize()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="121" class="link-to-prism">consolidated/stompjs/src/frame.ts:121</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>serialize this Frame in a format suitable to be passed to WebSocket.
If the body is string the output will be string.
If the body is binary (i.e. of type Unit8Array) it will be serialized to ArrayBuffer.</p>
</div>

                            <div class="io-description">
                                <b>Returns : </b>    <code>string | ArrayBuffer</code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>






            <section>
    <h3 id="accessors">
        Accessors
    </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="body"></a>
                        <span class="name"><b>body</b><a href="#body"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>body()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="32" class="link-to-prism">consolidated/stompjs/src/frame.ts:32</a></div>
                                </td>
                            </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>body of the frame</p>
</div>

                                <div class="io-description">
                                    <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                </div>
                        </td>
                    </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="binaryBody"></a>
                        <span class="name"><b>binaryBody</b><a href="#binaryBody"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>binaryBody()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="43" class="link-to-prism">consolidated/stompjs/src/frame.ts:43</a></div>
                                </td>
                            </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>body as Uint8Array</p>
</div>

                                <div class="io-description">
                                    <b>Returns : </b>    <code>Uint8Array</code>

                                </div>
                        </td>
                    </tr>

            </tbody>
        </table>
</section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {StompHeaders} from &quot;./stomp-headers&quot;;
import {Byte} from &quot;./byte&quot;;
import {RawFrameType} from &quot;./types&quot;;

/**
 * @internal
 */
type unmarshallResults &#x3D; { frames: Frame[]; partial: string };

/**
 * Frame class represents a STOMP frame. Many of the callbacks pass the Frame received from
 * the STOMP broker. For advanced usage you might need to access [headers]{@link Frame#headers}.
 *
 * {@link Message} is an extended Frame.
 */
export class Frame {
  /**
   * STOMP Command
   */
  public command: string;

  /**
   * Headers, key value pairs.
   */
  public headers: StompHeaders;

  public isBinaryBody: boolean;

  /**
   * body of the frame
   */
  get body(): string {
    if (!this._body &amp;&amp; this.isBinaryBody) {
      this._body &#x3D; new TextDecoder().decode(this._binaryBody);
    }
    return this._body;
  }
  private _body: string;

  /**
   * body as Uint8Array
   */
  get binaryBody(): Uint8Array {
    if (!this._binaryBody &amp;&amp; !this.isBinaryBody) {
      this._binaryBody &#x3D; new TextEncoder().encode(this._body);
    }
    return this._binaryBody;
  }
  private _binaryBody: Uint8Array;

  private escapeHeaderValues: boolean;
  private skipContentLengthHeader: boolean;

  /**
   * Frame constructor. &#x60;command&#x60;, &#x60;headers&#x60; and &#x60;body&#x60; are available as properties.
   *
   * @internal
   */
  constructor(params: {
    command: string, headers?: StompHeaders, body?: string, binaryBody?: Uint8Array,
    escapeHeaderValues?: boolean, skipContentLengthHeader?: boolean
  }) {
    let {command, headers, body, binaryBody, escapeHeaderValues, skipContentLengthHeader} &#x3D; params;
    this.command &#x3D; command;
    this.headers &#x3D; (&lt;any&gt;Object).assign({}, headers || {});

    if (binaryBody) {
      this._binaryBody &#x3D; binaryBody;
      this.isBinaryBody &#x3D; true;
    } else {
      this._body &#x3D; body || &#x27;&#x27;;
      this.isBinaryBody &#x3D; false;
    }
    this.escapeHeaderValues &#x3D; escapeHeaderValues || false;
    this.skipContentLengthHeader &#x3D; skipContentLengthHeader || false;
  }

  /**
   * deserialize a STOMP Frame from raw data.
   *
   * @internal
   */
  public static fromRawFrame(rawFrame: RawFrameType, escapeHeaderValues: boolean): Frame {
    const headers: StompHeaders &#x3D; {};
    const trim &#x3D; (str: string): string &#x3D;&gt; str.replace(/^\s+|\s+$/g, &#x27;&#x27;);

    // In case of repeated headers, as per standards, first value need to be used
    for (let header of rawFrame.headers.reverse()) {
      const idx &#x3D; header.indexOf(&#x27;:&#x27;);

      const key &#x3D; trim(header[0]);
      let value &#x3D; trim(header[1]);

      if (escapeHeaderValues &amp;&amp; (rawFrame.command !&#x3D;&#x3D; &#x27;CONNECT&#x27;) &amp;&amp; (rawFrame.command !&#x3D;&#x3D; &#x27;CONNECTED&#x27;)) {
        value &#x3D; Frame.hdrValueUnEscape(value);
      }

      headers[key] &#x3D; value;
    }

    return new Frame({
      command: rawFrame.command,
      headers: headers,
      binaryBody: rawFrame.binaryBody,
      escapeHeaderValues: escapeHeaderValues
    });
  }

  /**
   * @internal
   */
  public toString(): string {
    return this.serializeCmdAndHeaders();
  }

  /**
   * serialize this Frame in a format suitable to be passed to WebSocket.
   * If the body is string the output will be string.
   * If the body is binary (i.e. of type Unit8Array) it will be serialized to ArrayBuffer.
   */
  public serialize(): string|ArrayBuffer {
    const cmdAndHeaders &#x3D; this.serializeCmdAndHeaders();

    if(this.isBinaryBody) {
      return Frame.toUnit8Array(cmdAndHeaders, this._binaryBody).buffer;
    } else {
      return cmdAndHeaders + this._body + Byte.NULL;
    }
  }

  private serializeCmdAndHeaders(): string {
    const lines &#x3D; [this.command];
    if (this.skipContentLengthHeader) {
      delete this.headers[&#x27;content-length&#x27;];
    }

    for (let name of Object.keys(this.headers || {})) {
      const value &#x3D; this.headers[name];
      if (this.escapeHeaderValues &amp;&amp; (this.command !&#x3D;&#x3D; &#x27;CONNECT&#x27;) &amp;&amp; (this.command !&#x3D;&#x3D; &#x27;CONNECTED&#x27;)) {
        lines.push(&#x60;${name}:${Frame.hdrValueEscape(&#x60;${value}&#x60;)}&#x60;);
      } else {
        lines.push(&#x60;${name}:${value}&#x60;);
      }
    }
    if (this.isBinaryBody || (!this.isBodyEmpty() &amp;&amp; !this.skipContentLengthHeader)) {
      lines.push(&#x60;content-length:${this.bodyLength()}&#x60;);
    }
    return lines.join(Byte.LF) + Byte.LF + Byte.LF;
  }

  private isBodyEmpty(): boolean {
    return this.bodyLength() &#x3D;&#x3D;&#x3D; 0;
  }

  private bodyLength(): number {
    const binaryBody &#x3D; this.binaryBody;
    return binaryBody ? binaryBody.length : 0;
  }

  /**
   * Compute the size of a UTF-8 string by counting its number of bytes
   * (and not the number of characters composing the string)
   */
  private static sizeOfUTF8(s: string): number {
    return s ? new TextEncoder().encode(s).length : 0;
  }

  private static toUnit8Array(cmdAndHeaders: string, binaryBody: Uint8Array): Uint8Array {
    const uint8CmdAndHeaders &#x3D; new TextEncoder().encode(cmdAndHeaders);
    const nullTerminator &#x3D; new Uint8Array([0]);
    const uint8Frame &#x3D; new Uint8Array(uint8CmdAndHeaders.length + binaryBody.length + nullTerminator.length);

    uint8Frame.set(uint8CmdAndHeaders);
    uint8Frame.set(binaryBody, uint8CmdAndHeaders.length);
    uint8Frame.set(nullTerminator, uint8CmdAndHeaders.length + binaryBody.length);

    return uint8Frame;
  }
  /**
   * Serialize a STOMP frame as per STOMP standards, suitable to be sent to the STOMP broker.
   *
   * @internal
   */
  public static marshall(params: {
    command: string, headers?: StompHeaders, body?: string, binaryBody?: Uint8Array,
    escapeHeaderValues?: boolean, skipContentLengthHeader?: boolean
  }) {
    const frame &#x3D; new Frame(params);
    return frame.serialize();
  }

  /**
   *  Escape header values
   */
  private static hdrValueEscape(str: string): string {
    return str.replace(/\\/g, &quot;\\\\&quot;).replace(/\r/g, &quot;\\r&quot;).replace(/\n/g, &quot;\\n&quot;).replace(/:/g, &quot;\\c&quot;);
  }

  /**
   * UnEscape header values
   */
  private static hdrValueUnEscape(str: string): string {
    return str.replace(/\\r/g, &quot;\r&quot;).replace(/\\n/g, &quot;\n&quot;).replace(/\\c/g, &quot;:&quot;).replace(/\\\\/g, &quot;\\&quot;);
  }
}
</code></pre>
    </div>
</div>







                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'Frame.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
